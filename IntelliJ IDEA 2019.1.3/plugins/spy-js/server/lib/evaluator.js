/*
 * spy-js - v2.0.0
 * http://spy-js.com
 * Copyright (c) 2013-2017 JetBrains - All Rights Reserved.
 *
 * This source code file is a part of spy-js plugin.
 */
module.exports={evaluate:function(a){var b=this,c=a.evaluator,d=a.request,e=a.result;b._safeObject=a.safeObject||function(a){return a},b._original=a.original,b._evaluatedPropertyNumberLimit=a.evaluatedPropertyNumberLimit||600,b._evaluatedStrLengthLimit=a.evaluatedStrLengthLimit||100;var f=d.autocomplete,g=d.onlyValidPropNames,h=d.expression,i=d.fullString,j=d.threshold,k=d.from,l=d.to,m=d.includeProps;try{var n=c(h)}catch(a){e.error='Failed to evaluate "'+h+'": '+(a&&a.message||"")}if(!e.error)try{var o=b._displayTypeAndValue(n).type,p="array"===o;if(f||(e.value=b._propertyBase(h,n,o,!1,i)),m){if(p)var q=n.splice(0,f?n.length:e.value.length);try{var r=p&&!!j;if(r){var s=l-k-1;if(j<s){var t=j*j;e.value.ranges=b._ranges(q,k,l,t<s?t:j)}else for(var u=k;u<l;u++)e.properties.push(b._property(q,u,!1,i))}else if(n&&"string"!==o){var v={};for(var w in n){if(e.properties.length>=b._evaluatedPropertyNumberLimit)break;v["prop:"+w]=1;try{var x=w;if(!b._valid(x,g))continue;e.properties.push(b._property(n,x,f,i))}catch(a){e.error='Failed to process "'+w+'" property: '+(a&&a.message||"")}}p&&!v["prop:length"]&&(e.properties.push(b._property(q,"length",f,i)),v["prop:length"]=1);for(var y=b._original.GetOwnPropertyNames?b._original.GetOwnPropertyNames(n):[],z=0,A=y.length;z<A;z++)try{if(e.properties.length>=b._evaluatedPropertyNumberLimit)break;var B=y[z];if(v["prop:"+B]||!b._valid(B,g))continue;e.properties.push(b._property(n,B,f,i))}catch(a){e.error='Failed to process "'+w+'" own property: '+(a&&a.message||"")}}}finally{p&&n.splice.apply(n,[0,0].concat(q))}}}catch(a){e.error='Failed to get "'+h+'" properties: '+(a&&a.message||"")}},_valid:function(a,b){var c=this;return!c._tracingSpecificProperty(a)&&(!b||/^[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/.test(a))},_ranges:function(a,b,c,d){var e=[],f=b+Math.min(d,c)-1,g=b,h=!1;do{var i=g,j=f;if(g+=d,f=g+Math.min(d,c-g)-1,f-g===0&&(j++,h=!0),e.push(i),e.push(j),g>=c)break}while(!h);return e},_propertyBase:function(a,b,c,d,e){var f=this,g=f._safeObject({name:a,type:c});d||(g.value=f._reportedValueType(c)?f._reportedValue(c,b,e):f._original.Undefined,g.length=b?b.length:0,g.empty=!(b&&!f._primitiveType(c))||f._empty(b));var h=!("function"!==c||d&&/^[A-Z]/.test(a));if(h)var i=f._original.FunctionToString.call(b||""),j=i.substring(i.indexOf("(")+1,i.indexOf(")"))||"";return g.params=h?j:f._original.Undefined,g},_property:function(a,b,c,d){var e=this,f=e._displayTypeAndValue(a,b),g=f.type,h=f.value;return e._propertyBase(b,h,g,c,d)},_empty:function(a){try{for(var b in a)return!1}catch(a){return!0}return!0},_reportedValueType:function(a){return this._primitiveType(a)||"date"===a},_primitiveType:function(a){return"number"===a||"boolean"===a||"string"===a},_reportedValue:function(a,b,c){var d=this;return"string"===a&&!c&&b.length>d._evaluatedStrLengthLimit&&(b=b.slice(0,d._evaluatedStrLengthLimit)),"date"===a?d._original.DateToString.apply(b):b.toString()},_tracingSpecificProperty:function(a){return"__p"===a.substring(0,3)||"_spy_js"===a||"_forceNormalRequire"===a||"newSetTimeout"===a||"newSetInterval"===a||"originalSetTimeout"===a||"originalSetInterval"===a},_displayTypeAndValue:function(a,b){var c=this,d="",e=a;if(b!==c._original.Undefined)try{e=a[b],d=typeof e}catch(a){}else d=typeof e;return"object"===d?"[object Array]"===c._original.ObjectToString.call(e)?d="array":"[object Date]"===c._original.ObjectToString.call(e)?d="date":null===e?d="null":e.constructor&&(d=e.constructor.name||d,"String"===d&&(d="string"),"Number"===d&&(d="number"),"Boolean"===d&&(d="boolean")):"undefined"===d&&c._original.HTMLAllCollection&&e instanceof c._original.HTMLAllCollection&&(d="HTMLAllCollection"),{type:d,value:e}}};